# ========================================
# üîê ENTERPRISE SECURITY CONFIGURATION
# ========================================
# Copy this file to .env.security and fill in your values
# DO NOT commit .env.security to version control!

# ========================================
# Security Features Toggle
# ========================================
ENABLE_SECURITY_HEADERS=true
ENABLE_CSRF_PROTECTION=true
ENABLE_RATE_LIMITING=true
ENABLE_AUDIT_LOGGING=true
ENABLE_2FA=true
ENABLE_ENCRYPTION=true
ENABLE_SESSION_MANAGEMENT=true
ENABLE_ADVANCED_RBAC=true

# ========================================
# Encryption & Signing Keys
# ========================================
# Generate these using: node scripts/generate-security-keys.js
MASTER_ENCRYPTION_KEY=YOUR_BASE64_ENCODED_32_BYTE_KEY_HERE
JWT_SECRET=YOUR_STRONG_JWT_SECRET_HERE
JWT_PRIVATE_KEY_PATH=.keys/jwt-private.pem
JWT_PUBLIC_KEY_PATH=.keys/jwt-public.pem
REFRESH_PRIVATE_KEY_PATH=.keys/refresh-private.pem
REFRESH_PUBLIC_KEY_PATH=.keys/refresh-public.pem
CSRF_SECRET=YOUR_CSRF_SECRET_HERE
SESSION_SECRET=YOUR_SESSION_SECRET_HERE
OTP_SECRET=YOUR_OTP_SECRET_HERE

# ========================================
# JWT Configuration
# ========================================
ACCESS_TOKEN_EXPIRY=15m
REFRESH_TOKEN_EXPIRY=7d
JWT_AUDIENCE=sooq-mazad
JWT_ISSUER=sooq-mazad-api
JWT_ALGORITHM=RS256
ROTATE_REFRESH_TOKENS=true

# ========================================
# Session Management
# ========================================
SESSION_TIMEOUT=1800000  # 30 minutes in milliseconds
SESSION_ABSOLUTE_TIMEOUT=86400000  # 24 hours in milliseconds
MAX_CONCURRENT_SESSIONS=3
SESSION_EXTEND_ON_ACTIVITY=true
SESSION_COOKIE_NAME=sooq-session
SESSION_COOKIE_SECURE=true  # Set to false in development
SESSION_COOKIE_HTTPONLY=true
SESSION_COOKIE_SAMESITE=strict

# ========================================
# Rate Limiting Configuration
# ========================================
# General API
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes

# Login attempts
LOGIN_RATE_LIMIT_MAX=5
LOGIN_RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
LOGIN_BLOCK_DURATION_MS=900000  # 15 minutes

# Registration
REGISTER_RATE_LIMIT_MAX=3
REGISTER_RATE_LIMIT_WINDOW_MS=3600000  # 1 hour

# Password reset
PASSWORD_RESET_RATE_LIMIT_MAX=3
PASSWORD_RESET_RATE_LIMIT_WINDOW_MS=3600000  # 1 hour

# File upload
UPLOAD_RATE_LIMIT_MAX=10
UPLOAD_RATE_LIMIT_WINDOW_MS=300000  # 5 minutes

# SMS/Email
SMS_RATE_LIMIT_MAX=2
SMS_RATE_LIMIT_WINDOW_MS=3600000  # 1 hour
EMAIL_RATE_LIMIT_MAX=5
EMAIL_RATE_LIMIT_WINDOW_MS=3600000  # 1 hour

# ========================================
# Two-Factor Authentication (2FA)
# ========================================
# TOTP Configuration
TOTP_WINDOW=1  # Number of time steps to check before/after
TOTP_STEP=30  # Time step in seconds
TOTP_DIGITS=6
TOTP_ALGORITHM=SHA1
TOTP_ISSUER=Sooq Mazad

# OTP Configuration
OTP_LENGTH=6
OTP_EXPIRY=300  # 5 minutes in seconds
OTP_MAX_ATTEMPTS=3
BACKUP_CODES_COUNT=10

# Account lockout
MAX_LOGIN_ATTEMPTS=5
LOCKOUT_DURATION=900  # 15 minutes in seconds
LOCKOUT_RESET_ON_SUCCESS=true

# ========================================
# SMS Provider Configuration
# ========================================
SMS_PROVIDER=twilio  # Options: twilio, nexmo, aws-sns, custom
SMS_API_KEY=YOUR_SMS_API_KEY
SMS_API_SECRET=YOUR_SMS_API_SECRET
SMS_FROM_NUMBER=+218XXXXXXXXX
SMS_TEST_MODE=false  # Set to true to prevent actual SMS sending

# Twilio specific (if using Twilio)
TWILIO_ACCOUNT_SID=YOUR_TWILIO_ACCOUNT_SID
TWILIO_AUTH_TOKEN=YOUR_TWILIO_AUTH_TOKEN
TWILIO_FROM_NUMBER=+218XXXXXXXXX

# ========================================
# Email Configuration
# ========================================
EMAIL_PROVIDER=smtp  # Options: smtp, sendgrid, aws-ses, mailgun
EMAIL_FROM_ADDRESS=security@sooq-mazad.com
EMAIL_FROM_NAME=Sooq Mazad Security

# SMTP Configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_SECURE=false  # true for 465, false for other ports
SMTP_USER=YOUR_EMAIL@gmail.com
SMTP_PASS=YOUR_APP_PASSWORD

# ========================================
# Security Headers
# ========================================
CSP_DIRECTIVES="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline';"
HSTS_MAX_AGE=31536000  # 1 year
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true
X_FRAME_OPTIONS=DENY
X_CONTENT_TYPE_OPTIONS=nosniff
X_XSS_PROTECTION=1; mode=block
REFERRER_POLICY=strict-origin-when-cross-origin

# ========================================
# CSRF Protection
# ========================================
CSRF_TOKEN_LENGTH=32
CSRF_TOKEN_EXPIRY=3600  # 1 hour in seconds
CSRF_COOKIE_NAME=csrf-token
CSRF_HEADER_NAME=x-csrf-token
CSRF_ROTATE_TOKENS=false
CSRF_SKIP_METHODS=GET,HEAD,OPTIONS

# ========================================
# Audit Logging
# ========================================
AUDIT_LOG_ENABLED=true
AUDIT_LOG_LEVEL=INFO  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL
AUDIT_LOG_RETENTION_DAYS=90
AUDIT_LOG_TO_FILE=true
AUDIT_LOG_TO_DATABASE=true
AUDIT_LOG_TO_CONSOLE=false  # Set to true in development
AUDIT_LOG_FILE_PATH=logs/audit.log
AUDIT_CRITICAL_ALERTS=true
AUDIT_CLEANUP_SCHEDULE=0 0 * * 0  # Weekly at midnight

# ========================================
# Access Control (RBAC/ABAC)
# ========================================
ENABLE_DYNAMIC_PERMISSIONS=true
PERMISSION_CACHE_TTL=300  # 5 minutes in seconds
ROLE_HIERARCHY_ENABLED=true
ATTRIBUTE_POLICIES_ENABLED=true
RESOURCE_OWNERSHIP_CHECK=true

# Allowed admin IPs (comma-separated)
ALLOWED_ADMIN_IPS=127.0.0.1,::1

# Working hours restriction (for support staff)
ENFORCE_WORKING_HOURS=false
WORKING_HOURS_START=09:00
WORKING_HOURS_END=18:00
WORKING_DAYS=1,2,3,4,5  # Monday to Friday

# ========================================
# Password Policy
# ========================================
PASSWORD_MIN_LENGTH=8
PASSWORD_MAX_LENGTH=128
PASSWORD_REQUIRE_UPPERCASE=true
PASSWORD_REQUIRE_LOWERCASE=true
PASSWORD_REQUIRE_NUMBERS=true
PASSWORD_REQUIRE_SPECIAL=true
PASSWORD_HISTORY_COUNT=5  # Remember last N passwords
PASSWORD_EXPIRY_DAYS=90
PASSWORD_COMPLEXITY_SCORE=3  # 0-4, higher is stronger

# ========================================
# Monitoring & Alerting
# ========================================
MONITORING_ENABLED=true
MONITORING_WEBHOOK_URL=https://your-monitoring-service.com/webhook
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
DATADOG_API_KEY=YOUR_DATADOG_API_KEY
NEW_RELIC_LICENSE_KEY=YOUR_NEW_RELIC_KEY

# Alert thresholds
ALERT_ON_FAILED_LOGINS=10  # Alert after N failed logins
ALERT_ON_RATE_LIMIT=50  # Alert after N rate limit hits
ALERT_ON_SUSPICIOUS_ACTIVITY=true
ALERT_ON_CRITICAL_ERRORS=true

# ========================================
# Database Security
# ========================================
DB_ENCRYPTION_AT_REST=true
DB_FIELD_LEVEL_ENCRYPTION=true
DB_AUDIT_QUERIES=true
DB_CONNECTION_SSL=true
DB_CONNECTION_POOL_MIN=2
DB_CONNECTION_POOL_MAX=10

# ========================================
# Redis/Cache Configuration
# ========================================
REDIS_URL=redis://localhost:6379
REDIS_PASSWORD=YOUR_REDIS_PASSWORD
REDIS_TLS=false
REDIS_DB=0
CACHE_TTL_DEFAULT=300  # 5 minutes
CACHE_TTL_SESSION=1800  # 30 minutes
CACHE_TTL_RATE_LIMIT=900  # 15 minutes

# ========================================
# Development/Testing Overrides
# ========================================
# These settings override security in development
# DO NOT use these in production!
DEV_DISABLE_CSRF=false
DEV_DISABLE_RATE_LIMIT=false
DEV_DISABLE_HTTPS_CHECK=true
DEV_VERBOSE_ERRORS=true
DEV_MOCK_SMS=true
DEV_MOCK_EMAIL=true
TEST_ENABLE_AUDIT=false

# ========================================
# Compliance & Legal
# ========================================
GDPR_COMPLIANT=true
DATA_RETENTION_DAYS=365
RIGHT_TO_ERASURE_ENABLED=true
DATA_PORTABILITY_ENABLED=true
COOKIE_CONSENT_REQUIRED=true
PRIVACY_POLICY_VERSION=1.0.0
TERMS_VERSION=1.0.0

# ========================================
# END OF CONFIGURATION
# ========================================
