# إعدادات PostgreSQL محسنة للأداء العالي
# PostgreSQL Performance Configuration for High Traffic

# إعدادات الذاكرة المحسنة للزيارات العالية - Enhanced Memory Settings
shared_buffers = 512MB                    # 25% من الذاكرة المتاحة (محسن للزيارات العالية)
effective_cache_size = 2GB                # 75% من الذاكرة المتاحة (محسن)
work_mem = 8MB                            # ذاكرة العمليات (محسن للاستعلامات المعقدة)
maintenance_work_mem = 128MB              # ذاكرة الصيانة (محسن)
wal_buffers = 32MB                        # ذاكرة WAL (محسن)
huge_pages = try                          # محاولة استخدام الصفحات الكبيرة

# إعدادات الاتصالات المحسنة - Enhanced Connection Settings
max_connections = 500                     # الحد الأقصى للاتصالات (محسن للزيارات العالية)
superuser_reserved_connections = 5        # اتصالات محجوزة للمدير (محسن)

# إعدادات WAL - Write Ahead Logging
wal_level = replica                       # مستوى WAL
max_wal_size = 1GB                       # الحد الأقصى لحجم WAL
min_wal_size = 80MB                      # الحد الأدنى لحجم WAL
checkpoint_completion_target = 0.9        # هدف إكمال نقطة التحقق
wal_compression = on                      # ضغط WAL

# إعدادات الاستعلامات المحسنة - Enhanced Query Settings
random_page_cost = 1.1                   # تكلفة الصفحة العشوائية (SSD optimized)
effective_io_concurrency = 300           # التزامن I/O (محسن للزيارات العالية)
seq_page_cost = 1.0                      # تكلفة الصفحة المتسلسلة
cpu_tuple_cost = 0.01                    # تكلفة معالجة الصف
cpu_index_tuple_cost = 0.005             # تكلفة معالجة صف الفهرس
cpu_operator_cost = 0.0025               # تكلفة المشغل

# إعدادات التوازي المحسنة - Enhanced Parallel Settings
max_worker_processes = 16                 # عدد العمليات المتوازية (محسن)
max_parallel_workers_per_gather = 4      # العمال المتوازيون لكل جمع (محسن)
max_parallel_workers = 16                # إجمالي العمال المتوازيين (محسن)
max_parallel_maintenance_workers = 4     # عمال الصيانة المتوازيون (محسن)
min_parallel_table_scan_size = 8MB       # الحد الأدنى لحجم فحص الجدول المتوازي
min_parallel_index_scan_size = 512kB     # الحد الأدنى لحجم فحص الفهرس المتوازي

# إعدادات التخزين المؤقت - Caching Settings
shared_preload_libraries = 'pg_stat_statements'
track_activity_query_size = 2048
pg_stat_statements.track = all
pg_stat_statements.max = 10000

# إعدادات الأداء المحسنة - Enhanced Performance Settings
default_statistics_target = 500          # هدف الإحصائيات (محسن للدقة)
constraint_exclusion = partition         # استبعاد القيود
cursor_tuple_fraction = 0.1              # جزء المؤشر
from_collapse_limit = 8                  # حد انهيار FROM
join_collapse_limit = 8                  # حد انهيار JOIN
geqo = on                                # مُحسِّن الاستعلام الجيني
geqo_threshold = 12                      # عتبة GEQO

# إعدادات الفهرسة المحسنة - Enhanced Indexing Settings
enable_bitmapscan = on                   # تمكين فحص البت
enable_hashjoin = on                     # تمكين ربط التجمع
enable_mergejoin = on                    # تمكين ربط الدمج
enable_nestloop = on                     # تمكين الحلقة المتداخلة
enable_indexscan = on                    # تمكين فحص الفهرس
enable_indexonlyscan = on                # تمكين فحص الفهرس فقط
enable_seqscan = on                      # تمكين الفحص المتسلسل

# إعدادات التسجيل - Logging Settings
log_destination = 'stderr'               # وجهة السجل
logging_collector = on                   # جامع السجلات
log_directory = 'log'                    # مجلد السجلات
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'
log_rotation_age = 1d                    # عمر دوران السجل
log_rotation_size = 10MB                 # حجم دوران السجل
log_min_duration_statement = 1000       # الحد الأدنى لمدة البيان (1 ثانية)
log_checkpoints = on                     # تسجيل نقاط التحقق
log_connections = on                     # تسجيل الاتصالات
log_disconnections = on                  # تسجيل قطع الاتصال
log_lock_waits = on                      # تسجيل انتظار الأقفال

# إعدادات الأمان - Security Settings
ssl = off                                # SSL (يمكن تفعيله في الإنتاج)
password_encryption = scram-sha-256      # تشفير كلمة المرور

# إعدادات التنظيف التلقائي - Autovacuum Settings
autovacuum = on                          # التنظيف التلقائي
autovacuum_max_workers = 3               # عدد عمال التنظيف
autovacuum_naptime = 1min                # فترة نوم التنظيف
autovacuum_vacuum_threshold = 50         # عتبة التنظيف
autovacuum_analyze_threshold = 50        # عتبة التحليل
autovacuum_vacuum_scale_factor = 0.2     # عامل مقياس التنظيف
autovacuum_analyze_scale_factor = 0.1    # عامل مقياس التحليل

# إعدادات المنطقة الزمنية واللغة - Locale Settings
timezone = 'Africa/Tripoli'              # المنطقة الزمنية
lc_messages = 'en_US.UTF-8'             # لغة الرسائل
lc_monetary = 'ar_LY.UTF-8'             # تنسيق العملة
lc_numeric = 'ar_LY.UTF-8'              # تنسيق الأرقام
lc_time = 'ar_LY.UTF-8'                 # تنسيق الوقت
default_text_search_config = 'arabic'    # تكوين البحث النصي
